- name: start the nginx service
  service: 
    name: '{{ item }}'
    state: restarted
  with_items:
    - nginx
  become: yes

- name: "Install forever (to run Node.js app)."
  npm: name=forever global=yes state=present
  become: yes

- name: "Check list of Node.js apps running."
  command: forever list
  register: forever_list
  changed_when: false
  become: yes

- name: "Start example Node.js app."
  command: forever start server.js
  when: "forever_list.stdout.find('server.js') == -1"
  args: 
    chdir: /home/ubuntu/checkbox/server-side/site/
  environment:
    MONGO_PORT: "{{ MONGO_PORT }}"
    MONGO_IP: "{{ MONGO_IP }}"
    MONGO_USER: "{{ MONGO_USER }}"
    MONGO_PASSWORD: "{{ MONGO_PASSWORD }}"
  become: yes
  
# - name: Run 
#   command: nohup node server.js &
#   args: 
#     chdir: /home/ubuntu/checkbox/server-side/site/
#   environment:
#     MONGO_PORT: "{{ MONGO_PORT }}"
#     MONGO_IP: "{{ MONGO_IP }}"
#     MONGO_USER: "{{ MONGO_USER }}"
#     MONGO_PASSWORD: "{{ MONGO_PASSWORD }}"
#   become: yes
